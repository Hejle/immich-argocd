# REQUIRED BY THE CHART (per README)
image:
  tag: v2.1.0 #TODO

# Enables the bundled Valkey (replaces Redis subchart)
valkey:
  enabled: true

immich:
  # Mount the existing PVC created above
  persistence:
    library:
      enabled: true
      existingClaim: immich-library

  # Database & Redis connection (common-library merges to all components)
  env:
    # CNPG write service for our cluster: <cluster-name>-rw
    DB_HOSTNAME: immich-db-rw
    DB_PORT: "5432"
    DB_DATABASE_NAME: immich
    REDIS_HOSTNAME: '{{ printf "%s-redis-master" .Release.Name }}'

  # Pull DB user/password from a Secret created below (so values.yaml can stay public)
  envFrom:
    - secretRef:
        name: immich-db-app-env

ingress:
  main:
    enabled: true
    className: traefik
    hosts:
      - host: immich.hejlepi.local
        paths:
          - path: /
            pathType: Prefix
    # Optional TLS if you have a cert (SAN or wildcard)
    tls:
      - hosts:
          - immich.hejlepi.local
        secretName: hejlepi-local-tls

# Optional: constrain to ARM64 nodes (Raspberry Pi)
controllers:
  # apply to all components via common-library
  main:
    pod:
      nodeSelector:
        kubernetes.io/arch: arm64
        kubernetes.io/os: linux
